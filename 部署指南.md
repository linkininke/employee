# 员工信息管理系统部署指南

## 1. 部署准备

### 1.1 环境要求

| 组件 | 版本要求 | 说明 |
|------|----------|------|
| JDK | 17+ | 运行Spring Boot应用 |
| MySQL | 8.0+ | 数据库服务 |
| Nginx | 1.18+ | 部署前端静态文件 |
| 服务器 | Linux/Windows | 建议使用Linux系统 |

### 1.2 打包成果

- **后端**：`employee-backend/target/employee-backend-1.0.0-SNAPSHOT.jar`
- **前端**：`employee-frontend/dist/` 目录下的静态文件

## 2. 数据库部署

### 2.1 安装MySQL

#### Linux系统
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server

# CentOS/RHEL
sudo yum install mysql-server
sudo systemctl start mysqld
sudo systemctl enable mysqld
```

#### Windows系统
1. 从MySQL官网下载安装包
2. 运行安装程序，选择"Server Only"安装类型
3. 设置root密码
4. 完成安装

### 2.2 配置数据库

1. 登录MySQL：
   ```bash
   mysql -u root -p
   ```

2. 创建数据库：
   ```sql
   CREATE DATABASE employee_management DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

3. 导入初始数据：
   ```bash
   mysql -u root -p employee_management < employee-backend/src/main/resources/db/init.sql
   ```

4. 创建数据库用户并授权：
   ```sql
   CREATE USER 'employee'@'localhost' IDENTIFIED BY 'employee123';
   GRANT ALL PRIVILEGES ON employee_management.* TO 'employee'@'localhost';
   FLUSH PRIVILEGES;
   ```

## 3. 后端部署

### 3.1 配置文件修改

1. 复制配置文件：
   ```bash
   mkdir -p /opt/employee/config
   cp employee-backend/src/main/resources/application.yml /opt/employee/config/
   ```

2. 修改配置文件（根据实际环境调整）：
   ```yaml
   spring:
     datasource:
       url: jdbc:mysql://localhost:3306/employee_management?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
       username: employee
       password: employee123
   ```

### 3.2 启动后端服务

#### 方式1：直接运行（开发环境）
```bash
java -jar employee-backend-1.0.0-SNAPSHOT.jar
```

#### 方式2：作为系统服务运行（生产环境）

##### Linux系统
1. 创建服务文件：
   ```bash
   sudo vi /etc/systemd/system/employee-backend.service
   ```

2. 添加以下内容：
   ```ini
   [Unit]
   Description=Employee Management System Backend
   After=syslog.target network.target
   
   [Service]
   Type=simple
   User=root
   WorkingDirectory=/opt/employee
   ExecStart=/usr/bin/java -jar /opt/employee/employee-backend-1.0.0-SNAPSHOT.jar --spring.config.location=/opt/employee/config/application.yml
   Restart=always
   
   [Install]
   WantedBy=multi-user.target
   ```

3. 启动服务：
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl start employee-backend
   sudo systemctl enable employee-backend
   ```

##### Windows系统
1. 使用WinSW将jar包注册为Windows服务
2. 下载WinSW：https://github.com/winsw/winsw/releases
3. 创建配置文件 `employee-backend.xml`：
   ```xml
   <service>
     <id>employee-backend</id>
     <name>Employee Management System Backend</name>
     <description>员工信息管理系统后端服务</description>
     <executable>java</executable>
     <arguments>-jar "%BASE%\employee-backend-1.0.0-SNAPSHOT.jar"</arguments>
     <logpath>%BASE%\logs</logpath>
     <logmode>rotate</logmode>
   </service>
   ```
4. 安装服务：
   ```cmd
   employee-backend.exe install
   ```
5. 启动服务：
   ```cmd
   net start employee-backend
   ```

### 3.3 验证后端服务

访问 `http://localhost:8080/api/employees`，如果返回JSON数据，说明后端服务启动成功。

## 4. 前端部署

### 4.1 安装Nginx

#### Linux系统
```bash
# Ubuntu/Debian
sudo apt install nginx

# CentOS/RHEL
sudo yum install nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### Windows系统
1. 从Nginx官网下载Windows版本
2. 解压到 `C:\nginx` 目录
3. 启动Nginx：
   ```cmd
   cd C:\nginx
   start nginx
   ```

### 4.2 部署前端文件

1. 复制前端文件到Nginx目录：
   ```bash
   # Linux
   sudo mkdir -p /usr/share/nginx/html/employee
   sudo cp -r employee-frontend/dist/* /usr/share/nginx/html/employee/
   
   # Windows
   xcopy /E employee-frontend\dist C:\nginx\html\employee\
   ```

2. 配置Nginx虚拟主机：

   #### Linux系统
   ```bash
   sudo vi /etc/nginx/conf.d/employee.conf
   ```

   添加以下内容：
   ```nginx
   server {
       listen 80;
       server_name localhost;
       
       location /employee {
           root /usr/share/nginx/html;
           index index.html;
           try_files $uri $uri/ /employee/index.html;
       }
       
       location /api {
           proxy_pass http://localhost:8080;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }
   ```

   #### Windows系统
   编辑 `C:\nginx\conf\nginx.conf`，在 `http` 块中添加：
   ```nginx
   server {
       listen 80;
       server_name localhost;
       
       location /employee {
           root html;
           index index.html;
           try_files $uri $uri/ /employee/index.html;
       }
       
       location /api {
           proxy_pass http://localhost:8080;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }
   ```

3. 重启Nginx：
   ```bash
   # Linux
   sudo systemctl restart nginx
   
   # Windows
   cd C:\nginx
   nginx -s reload
   ```

### 4.3 验证前端部署

访问 `http://localhost/employee`，如果能看到登录页面，说明前端部署成功。

## 5. 系统访问

### 5.1 登录信息

- **URL**：`http://localhost/employee`
- **用户名**：admin
- **密码**：admin123

### 5.2 功能验证

1. 登录系统
2. 查看员工列表
3. 添加新员工
4. 查看部门列表
5. 添加新部门
6. 查看职位列表
7. 添加新职位
8. 查看薪资记录
9. 添加新薪资记录

## 6. 常见问题排查

### 6.1 后端服务无法启动

1. 检查端口是否被占用：
   ```bash
   netstat -tlnp | grep 8080
   ```

2. 查看日志：
   ```bash
   # Linux系统服务日志
   sudo journalctl -u employee-backend
   
   # 直接运行日志
   java -jar employee-backend-1.0.0-SNAPSHOT.jar > logs/backend.log 2>&1
   ```

### 6.2 前端无法访问后端

1. 检查Nginx配置是否正确
2. 检查后端服务是否正常运行
3. 检查防火墙设置：
   ```bash
   # Linux
   sudo firewall-cmd --list-ports
   sudo firewall-cmd --add-port=8080/tcp --permanent
   sudo firewall-cmd --reload
   ```

### 6.3 数据库连接失败

1. 检查数据库配置文件
2. 检查数据库服务是否运行
3. 检查数据库用户权限

## 7. 升级指南

### 7.1 后端升级

1. 停止当前服务：
   ```bash
   # Linux系统服务
   sudo systemctl stop employee-backend
   
   # 直接运行
   # 找到进程ID并杀死
   ps aux | grep java
   kill -9 <pid>
   ```

2. 替换jar包：
   ```bash
   cp new-employee-backend.jar /opt/employee/employee-backend-1.0.0-SNAPSHOT.jar
   ```

3. 启动服务：
   ```bash
   sudo systemctl start employee-backend
   ```

### 7.2 前端升级

1. 备份旧文件：
   ```bash
   mv /usr/share/nginx/html/employee /usr/share/nginx/html/employee_backup
   ```

2. 复制新文件：
   ```bash
   cp -r new-dist/* /usr/share/nginx/html/employee/
   ```

3. 重启Nginx：
   ```bash
   sudo systemctl restart nginx
   ```

## 8. 监控与维护

### 8.1 日志管理

- **后端日志**：查看Spring Boot日志文件或系统服务日志
- **Nginx日志**：
  ```bash
  # Linux
  /var/log/nginx/access.log
  /var/log/nginx/error.log
  ```

### 8.2 定期备份

1. 数据库备份：
   ```bash
   mysqldump -u root -p employee_management > employee_management_$(date +%Y%m%d).sql
   ```

2. 配置文件备份：
   ```bash
   cp /opt/employee/config/application.yml /opt/employee/config/application.yml.$(date +%Y%m%d)
   ```

## 9. 联系方式

如有部署问题，请联系系统管理员。
